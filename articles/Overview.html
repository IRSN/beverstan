<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Overview of the beverstan package • beverstan</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Overview of the beverstan package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">beverstan</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.3</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Overview.html">Overview of the beverstan package</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Overview of the beverstan package</h1>
                        <h4 data-toc-skip class="author">Yves Deville <a href="mailto:deville.yves@alpestat.com" class="email">deville.yves@alpestat.com</a>
</h4>
            
      

      <div class="d-none name"><code>Overview.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a>
</h2>
<p>This report was generated with <code><a href="https://rdrr.io/pkg/knitr/man/spin.html" class="external-link">knitr::spin</a></code>. Do not edit
Rmarkdown file by hand!</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://irsn.github.io/beverstan/">beverstan</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="bayes-tvgev-for-the-annual-maxima-of-temperature-in-dijon">Bayes TVGEV for the annual maxima of temperature in Dijon<a class="anchor" aria-label="anchor" href="#bayes-tvgev-for-the-annual-maxima-of-temperature-in-dijon"></a>
</h2>
<div class="section level3">
<h3 id="tvgevbayes-objects">
<code>TVGEVBayes</code> objects<a class="anchor" aria-label="anchor" href="#tvgevbayes-objects"></a>
</h3>
<p>The function <code>TVGEVBayes</code> is very similar to
<code><a href="https://rdrr.io/pkg/NSGEV/man/TVGEV.html" class="external-link">NSGEV::TVGEV</a></code> function. It uses the same arguments:
<code>data</code>, <code>Date</code>, <code>response</code> to define
the data frame to use and the name of the variables date and response in
it. The date variable must be either a column with class
<code>"Date"</code> or a column that can be coerced with
<code>as.Date</code>, typically a character giving dates in POSIX
format. The response contains the annual maxima of daily maximal values
(TX) as recorded in Dijon-Longvic (France). The data where provided by
the <a href="https://www.ecad.eu/" class="external-link">European Climate Assesment &amp;
Dataset</a>.</p>
<p>The <code>design</code> argument contains R language: a call to a
function returning a design matrix. Then the three formulas
<code>loc</code>, <code>scale</code> and <code>shape</code> specify the
dependence of the GEV parameters on the date. Here we will use a
<code>design</code> for a “regression kink”: the response is a broken
line with a change of slope at a threshold point here chosen as
1970.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">within</a></span><span class="op">(</span><span class="va">TXMax_Dijon</span>, <span class="va">Date</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sprintf.html" class="external-link">sprintf</a></span><span class="op">(</span><span class="st">"%4d-01-01"</span>, <span class="va">Year</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TVGEVBayes.html">TVGEVBayes</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                  date <span class="op">=</span> <span class="st">"Date"</span>, response <span class="op">=</span> <span class="st">"TXMax"</span>,</span>
<span>                  design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/NSGEV/man/breaksX.html" class="external-link">breaksX</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">Date</span>, breaks <span class="op">=</span> <span class="st">"1970-01-01"</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                  loc <span class="op">=</span> <span class="op">~</span> <span class="va">t1</span> <span class="op">+</span> <span class="va">t1_1970</span>, scale <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                  seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: There were 1 divergent transitions after warmup. See</span></span>
<span><span class="co">## https://mc-stan.org/misc/warnings.html#divergent-transitions-after-warmup</span></span>
<span><span class="co">## to find out why this is a problem and how to eliminate them.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Examine the pairs() plot to diagnose sampling problems</span></span></code></pre>
<p>The output of the previous code chunk was not shown. The warning can
require further investigation, see later.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "TVGEVBayes"</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/methods.html" class="external-link">methods</a></span><span class="op">(</span>class <span class="op">=</span> <span class="st">"TVGEVBayes"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] autoplot coef     fitted   predict  print    profLik  RL       summary </span></span>
<span><span class="co">## [9] vcov    </span></span>
<span><span class="co">## see '?methods' for accessing help and source code</span></span></code></pre>
<p>So we can use <code>autoplot</code>.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Posterior mean for the GEV expectation"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> </span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-4-1.png" width="960"></p>
<p>The posterior mean of the GEV expectation is shown along with a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>95</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">95\%</annotation></semantics></math>
credible interval on it. Of course, the credible interval should not be
confouded with a prediction interval, which would be much larger.</p>
<p>Instead of the GEV expectation, we can similarly plot a quantile.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fit</span>, which <span class="op">=</span> <span class="st">"quantile"</span>, prob <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Posterior mean for the GEV quantile with probability 0.95"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-5-1.png" width="960"></p>
<p>Now try the <code>summary</code> method</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## o Call</span></span>
<span><span class="co">## TVGEVBayes(data = df, date = "Date", response = "TXMax", design = breaksX(date = Date, </span></span>
<span><span class="co">##     breaks = "1970-01-01", degree = 1), loc = ~t1 + t1_1970, </span></span>
<span><span class="co">##     scale = ~1, shape = ~1, seed = 1234)</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## o Parameters</span></span>
<span><span class="co">##                MAP post. mean post. sd post. L post. U</span></span>
<span><span class="co">## mu_0       32.0391    32.0418   0.3909 31.2701 32.7965</span></span>
<span><span class="co">## mu_t1      -0.0279    -0.0236   0.0164 -0.0546  0.0086</span></span>
<span><span class="co">## mu_t1_1970  0.0829     0.0772   0.0288  0.0196  0.1341</span></span>
<span><span class="co">## sigma_0     1.7696     1.8273   0.1561  1.5526  2.1666</span></span>
<span><span class="co">## xi_0       -0.1930    -0.1706   0.0736 -0.3046 -0.0170</span></span></code></pre>
<p>To remind of the design, we can apply the call on the data frame</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">des</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/with.html" class="external-link">with</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://rdrr.io/pkg/NSGEV/man/breaksX.html" class="external-link">breaksX</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">Date</span>,  breaks <span class="op">=</span> <span class="st">"1970-01-01"</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">des</span></span></code></pre></div>
<pre><code><span><span class="co">## Block time series</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## o First block: 1921-01-01</span></span>
<span><span class="co">## o Last block:  2016-01-01</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       date          t1     t1_1970 </span></span>
<span><span class="co">## 1921-01-01 -48.9993155   0.0000000 </span></span>
<span><span class="co">## 1922-01-01 -48.0000000   0.0000000 </span></span>
<span><span class="co">## 1923-01-01 -47.0006845   0.0000000 </span></span>
<span><span class="co">##   ... &lt;more rows&gt;</span></span>
<span><span class="co">## 2014-01-01  44.0000000  44.0000000 </span></span>
<span><span class="co">## 2015-01-01  44.9993155  44.9993155 </span></span>
<span><span class="co">## 2016-01-01  45.9986311  45.9986311</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">des</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Design basis"</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-7-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The column <code>"t1"</code> defines a linear trend with a slope of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mspace width="0.222em"></mspace><msup><mtext mathvariant="normal">year</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">1~\text{year}^{-1}</annotation></semantics></math>.
The colmun <code>"t1_1970"</code> defines a broken line with a change of
slope located at year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1970</mn><annotation encoding="application/x-tex">1970</annotation></semantics></math>:
the slopes are
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mspace width="0.222em"></mspace><msup><mtext mathvariant="normal">year</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">1~\text{year}^{-1}</annotation></semantics></math>
before
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1970</mn><annotation encoding="application/x-tex">1970</annotation></semantics></math>,
then
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mspace width="0.222em"></mspace><msup><mtext mathvariant="normal">year</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">1~\text{year}^{-1}</annotation></semantics></math>.
The parameter names are automatically build by pasting the GEV parameter
name <code>"mu"</code>, <code>"sigma"</code> or <code>"xi"</code> with
the name of the variable entering the formula. Note however that the
constant is not taken as <code>"(Intercept)"</code> as in
<code>lm</code> and many other models, but <code>"0"</code>. In the
present case, the eventual slope (after year 1970) is the sum of
<code>mu_t1</code> and <code>mu_t1_1970</code> because the two basis
functions are non-zero then. So for instance the posterior mean for the
eventual slope is 0.0536
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">C</mtext><mi>/</mi><msup><mtext mathvariant="normal">year</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\text{C}/\text{year}^{-1}</annotation></semantics></math>
or 0.536
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">C</mtext><mi>/</mi><msup><mtext mathvariant="normal">decade</mtext><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">\text{C}/\text{decade}^{-1}</annotation></semantics></math>.</p>
<p>We can see the (Bayesian) estimates of the parameters, along with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>95</mn><mi>%</mi></mrow><annotation encoding="application/x-tex">95\%</annotation></semantics></math>
credible intervals. Insasmuch the credible interval on
<code>mu_t1_1970</code> does not contain
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>,
we can say that the two slopes before and after
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1970</mn><annotation encoding="application/x-tex">1970</annotation></semantics></math>
are significantly different.</p>
<p>We can extract the coefficients with the <code>coef</code> method.
Since we may want either the MAP or the posterior mean, the method has
an ususual argument <code>type</code> which allows to make a choice.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        mu_0       mu_t1  mu_t1_1970     sigma_0        xi_0 </span></span>
<span><span class="co">## 32.03912611 -0.02790677  0.08289061  1.76955738 -0.19296432</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span>, type <span class="op">=</span> <span class="st">"postMean"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##        mu_0       mu_t1  mu_t1_1970     sigma_0        xi_0 </span></span>
<span><span class="co">## 32.04182925 -0.02361283  0.07721219  1.82728067 -0.17062777</span></span></code></pre>
<p>As its name may suggest, the <code>RL</code> method Return Level
plot.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RL.html">RL</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">myRL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Return level plot"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-9-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The credible limits are empirical quantiles of the MCMC iterates
which explains their wiggling aspect. They can be smoothed, although
this is only for aesthetical reasons.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myRL</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/RL.html">RL</a></span><span class="op">(</span><span class="va">fit</span>, smooth <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">myRL</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Return level plot (smoothed credible limits)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-10-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>We can use the <code>predict</code> method</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myPred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">myPred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    newTimeRange  Prob    Quant</span></span>
<span><span class="co">## 15    2016_2017 0.008 40.81713</span></span>
<span><span class="co">## 16    2016_2017 0.005 41.29651</span></span>
<span><span class="co">## 17    2016_2017 0.004 41.52736</span></span>
<span><span class="co">## 18    2016_2017 0.003 41.83012</span></span>
<span><span class="co">## 19    2016_2017 0.002 42.27019</span></span>
<span><span class="co">## 20    2016_2017 0.001 43.07133</span></span></code></pre>
<p>The column <code>newTimeRange</code> indicates the time range (or
period) on which the prediction is computed. Note that <code>Prob</code>
is the probability of exceedance, so in the classical cas where the
extremes are the large value, the interest is mainly on the last rows.
We see that the quantile with an exceedance probability of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.001</mn><annotation encoding="application/x-tex">0.001</annotation></semantics></math>
is 43.07 Celsius.</p>
<p>We can use the <code>newTimeRange</code> argument of the method
<code>predict</code> for the class <code>"TVGEVBayes"</code>. With
partial matching, we can simply use <code>new =</code></p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myPred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">fit</span>, new <span class="op">=</span> <span class="st">"2021_2050"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">myPred</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    newTimeRange  Prob    Quant</span></span>
<span><span class="co">## 15    2021_2050 0.008 46.08961</span></span>
<span><span class="co">## 16    2021_2050 0.005 46.80702</span></span>
<span><span class="co">## 17    2021_2050 0.004 47.17385</span></span>
<span><span class="co">## 18    2021_2050 0.003 47.67545</span></span>
<span><span class="co">## 19    2021_2050 0.002 48.44431</span></span>
<span><span class="co">## 20    2021_2050 0.001 49.95837</span></span></code></pre>
<p>Again a plot is drawn by using <code>autoplot</code>.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">myPred</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Predictive distribution for the maximum on 2021-2050"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-14-1.png" width="60%" style="display: block; margin: auto;"></p>
</div>
<div class="section level3">
<h3 id="mcmc-diagnostics">MCMC diagnostics<a class="anchor" aria-label="anchor" href="#mcmc-diagnostics"></a>
</h3>
<p>It is a good practice to carefully inspect the MCMC iterates provided
by <strong>Stan</strong>. For that aim, the excellent
<strong>Shiny</strong> interface provided by the
<strong>shinystan</strong> package is of great help.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/shinystan/" class="external-link">shinystan</a></span><span class="op">)</span></span>
<span><span class="va">my_sso</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/shinystan/reference/launch_shinystan.html" class="external-link">launch_shinystan</a></span><span class="op">(</span><span class="va">fit</span><span class="op">$</span><span class="va">stanFit</span><span class="op">)</span></span></code></pre></div>
<p>This chunk (not executed here) lauches the Shiny interface in the web
browser. This allows to get interactively: traceplots and scatterplots
for the parameters, convergence disagnostics, and much more.</p>
</div>
</div>
<div class="section level2">
<h2 id="censored-data-historical-data">Censored data, historical data<a class="anchor" aria-label="anchor" href="#censored-data-historical-data"></a>
</h2>
<div class="section level3">
<h3 id="censoring-by-interval">Censoring by interval<a class="anchor" aria-label="anchor" href="#censoring-by-interval"></a>
</h3>
<p>Beside the Bayesian inference the <code>TVGEVBayes</code> function
allows the use of observations that are censored, more precisely:
censored by interval. Instead of the exact value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>y</mi><mi>t</mi></msub><annotation encoding="application/x-tex">y_t</annotation></semantics></math>
for the time (year)
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>,
we only know that the observation for a given year falls in an interval
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mtext mathvariant="normal">L</mtext><mo>,</mo><mi>t</mi></mrow></msub><mo>,</mo><mspace width="0.167em"></mspace><msub><mi>y</mi><mrow><mtext mathvariant="normal">U</mtext><mo>,</mo><mi>t</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(y_{\text{L},t}, \, y_{\text{U},t})</annotation></semantics></math>.
Consequently the contribution of year
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>t</mi><annotation encoding="application/x-tex">t</annotation></semantics></math>
in the likelihood
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>log</mo><msub><mi>L</mi><mi>t</mi></msub><mo>=</mo><msub><mi>F</mi><mtext mathvariant="normal">GEV</mtext></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mtext mathvariant="normal">U</mtext><mo>,</mo><mi>t</mi></mrow></msub><mo>;</mo><mspace width="0.167em"></mspace><mi>𝛙</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>−</mo><msub><mi>F</mi><mtext mathvariant="normal">GEV</mtext></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>y</mi><mrow><mtext mathvariant="normal">L</mtext><mo>,</mo><mi>t</mi></mrow></msub><mo>;</mo><mspace width="0.167em"></mspace><mi>𝛙</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
   \log L_t = F_{\text{GEV}}(y_{\text{U},t};\, \boldsymbol{\psi}) -
            F_{\text{GEV}}(y_{\text{L},t};\, \boldsymbol{\psi}).
</annotation></semantics></math> We can take
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mtext mathvariant="normal">L</mtext><mo>,</mo><mi>t</mi></mrow></msub><mo>=</mo><mo>−</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">y_{\text{L},t} = -\infty</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>y</mi><mrow><mtext mathvariant="normal">U</mtext><mo>,</mo><mi>t</mi></mrow></msub><mo>=</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">y_{\text{U},t} = \infty</annotation></semantics></math>
using the <code>Inf</code> special number in R.</p>
<p>This kind of information can be given in <code>TVGEVBayes</code> by
using the optional <code>timeMAXdata</code> argument and giving as value
an object with class <code>"timeMAXdata"</code> constructed with creator
function of the same name. For instance it is believed that annual
maximum for year 1922 in Dijon-Longvic was
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≥</mo><mn>34.4</mn></mrow><annotation encoding="application/x-tex">\geq 34.4</annotation></semantics></math> C
since the last value was recorded on 1922-05-24.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tMD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/timeMAXdata.html">timeMAXdata</a></span><span class="op">(</span><span class="st">"1922_1922"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1922-05-24"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34.4</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">tMD</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "timeMAXdata"</span></span></code></pre>
<p>A natural way to represent such censored observations is to plot them
as a vertical segment rather than a point.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">tMD</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"timeMAXdata censored data"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-17-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>A segment reaching the limit of the plotting area should be
considered as possibly having an infinite bound as here.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fitCens</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/TVGEVBayes.html">TVGEVBayes</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>,</span>
<span>                      date <span class="op">=</span> <span class="st">"Date"</span>, response <span class="op">=</span> <span class="st">"TXMax"</span>,</span>
<span>                      timeMAXdata <span class="op">=</span> <span class="va">tMD</span>,</span>
<span>                      design <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/NSGEV/man/breaksX.html" class="external-link">breaksX</a></span><span class="op">(</span>date <span class="op">=</span> <span class="va">Date</span>, breaks <span class="op">=</span> <span class="st">"1970-01-01"</span>, degree <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>,</span>
<span>                      loc <span class="op">=</span> <span class="op">~</span> <span class="va">t1</span> <span class="op">+</span> <span class="va">t1_1970</span>, scale <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>                      seed <span class="op">=</span> <span class="fl">1234</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fitCens</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fitCens</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Posterior mean for the GEV expectation"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-18-1.png" width="960"></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">fitCens</span>, which <span class="op">=</span> <span class="st">"quantile"</span>, prob <span class="op">=</span> <span class="fl">0.95</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Posterior mean for the  GEV quantile with probability 0.95"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-19-1.png" width="960"></p>
</div>
<div class="section level3">
<h3 id="timemaxdata-objects">timeMaxdata objects<a class="anchor" aria-label="anchor" href="#timemaxdata-objects"></a>
</h3>
<p>The name <code>"timeMAXdata"</code> is formed after
<code>MAXdata</code> of the <strong>Renext</strong> package, although it
is quite different. A <code>timeMAXdata</code> object specifies a number
of periods or time ranges given in the creator through names as in a
<code>list</code> call. The names used must define time ranges (or
periods) with the syntax <em>begin</em><code>_</code><em>end</em>. The
corresponding value is itsel a list, with named elements corresponding
to the largest values on the time range. The name of an element is a
character string defining a date, and its value is a vector of length 1
or 2. In the first case the known (uncensored) value is given and in the
second case, the observation is censored and the two limits (possibly
infinite) ar given.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tMD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/timeMAXdata.html">timeMAXdata</a></span><span class="op">(</span><span class="st">"1922_1922"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1922-05-24"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34.4</span>, <span class="cn">Inf</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="time-ranges-or-periods-dates">Time ranges or periods, dates<a class="anchor" aria-label="anchor" href="#time-ranges-or-periods-dates"></a>
</h3>
<p>The time ranges are given as
<em>begin</em><code>_</code><em>end</em>, where <em>begin</em> and
<em>end</em> are year or date.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tMD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/timeMAXdata.html">timeMAXdata</a></span><span class="op">(</span><span class="st">"1922_1930"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1922-05-24"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34.4</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                       <span class="st">"1927-08-01"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36.0</span>, <span class="fl">37.0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">tMD</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_gray</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Illustrative timeMAXdata"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_files/figure-html/unnamed-chunk-21-1.png" width="60%" style="display: block; margin: auto;"></p>
<p>The provided information is for the years 1922 to 1930
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>9</mn><annotation encoding="application/x-tex">9</annotation></semantics></math>
years). We tell that the two largest observations are for years 1922 and
1927 and (optionally) provide the full date. In both case the
observations are censored by interval. By affirming that these are the
two largest observations, we tell that the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>7</mn><annotation encoding="application/x-tex">7</annotation></semantics></math>
remaining observations are certainly below, so are below
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>34.4</mn><annotation encoding="application/x-tex">34.4</annotation></semantics></math>.
So these observations will be considered as censored with bounds
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mi>∞</mi></mrow><annotation encoding="application/x-tex">-\infty</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>34.4</mn><annotation encoding="application/x-tex">34.4</annotation></semantics></math>.</p>
<p>A <code>timeMAXdata</code> object can similarly contain several
periods which should not intersect. Note that a key function is the
<code>byBloc</code> which aggregates the information by block, with a
default block duration of one year.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/byBlock.html">byBlock</a></span><span class="op">(</span><span class="va">tMD</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      period       date  y   yL   yU</span></span>
<span><span class="co">## 1 1922_1930 1922-01-01 NA 34.4  Inf</span></span>
<span><span class="co">## 2 1922_1930 1923-01-01 NA   NA 34.4</span></span>
<span><span class="co">## 3 1922_1930 1924-01-01 NA   NA 34.4</span></span>
<span><span class="co">## 4 1922_1930 1925-01-01 NA   NA 34.4</span></span>
<span><span class="co">## 5 1922_1930 1926-01-01 NA   NA 34.4</span></span>
<span><span class="co">## 6 1922_1930 1927-01-01 NA 36.0 37.0</span></span>
<span><span class="co">## 7 1922_1930 1928-01-01 NA   NA 34.4</span></span>
<span><span class="co">## 8 1922_1930 1929-01-01 NA   NA 34.4</span></span>
<span><span class="co">## 9 1922_1930 1930-01-01 NA   NA 34.4</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/byBlock.html">byBlock</a></span><span class="op">(</span><span class="va">tMD</span>, blockDuration <span class="op">=</span><span class="st">"2 years"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      period       date  y   yL   yU</span></span>
<span><span class="co">## 1 1922_1930 1922-01-01 NA 34.4  Inf</span></span>
<span><span class="co">## 2 1922_1930 1924-01-01 NA   NA 34.4</span></span>
<span><span class="co">## 3 1922_1930 1926-01-01 NA 36.0 37.0</span></span>
<span><span class="co">## 4 1922_1930 1928-01-01 NA   NA 34.4</span></span></code></pre>
<p>Note that there are major differences with the <code>MAXdata</code>
structure of <strong>Renext</strong></p>
<ul>
<li><p>A <code>timeMAXdata</code> does not embed a variable name. The
related variable is automatically named <code>y</code> so that
<code>yL</code>and <code>yU</code> are lower and upper bounds.</p></li>
<li><p>If several observations are given for a same year, an error is
cast when using <code>byBlock</code></p></li>
</ul>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tMD</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/timeMAXdata.html">timeMAXdata</a></span><span class="op">(</span><span class="st">"1922_1930"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="st">"1922-05-24"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">34.4</span>, <span class="cn">Inf</span><span class="op">)</span>,</span>
<span>                       <span class="st">"1922-08-01"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">36.0</span>, <span class="fl">37.0</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="fu"><a href="../reference/byBlock.html">byBlock</a></span><span class="op">(</span><span class="va">tMD</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in byBlock(tMD) : </span></span>
<span><span class="co">##   'Several MAXdata obs. in the same block. Not allowed yet.</span></span></code></pre>
<p>Also note that there are some inconsistencies in the vocabulary
because in <strong>Renext</strong> <code>MAXdata</code> a <em>block</em>
is to be undestood as a time range for which the max observations are
provided, whatever be the duration of this time range. Finally,
<code>MAXdata</code> can not contain censored observations.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Yves Deville.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer>
</div>





  </body>
</html>
